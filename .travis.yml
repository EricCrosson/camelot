---
language: c
branches:
  only:
    - master
    - ci
sudo: required
services:
  - docker

before_install:
  - git submodule update --init --recursive

install:
  - docker pull hamroctopus/spin
  - docker pull hamroctopus/latex-cmake

script:
  - mkdir -p src/build doc/report/build doc/presentation/build
  - docker run -t -v $(pwd):/data hamroctopus/spin /bin/bash -c "cd /data/src/build && cmake .. && make"
  - docker run -t -v $(pwd):/data hamroctopus/latex-cmake /bin/bash -c "cd /data/doc/report/build && cmake .. && make"
  - docker run -t -v $(pwd):/data hamroctopus/latex-cmake /bin/bash -c "cd /data/doc/presentation/build && cmake .. && make"

after_success:
  - mkdir $HOME/deliverables && cp -fv doc/report/build/report.pdf doc/presentation/build/presentation.pdf $HOME/deliverables
  - bin/hook-travis-publish-docs.sh

env:
  global:
    secure: KQpqZKvYktdfSqVcraFp8cyX3ZQTCpvFpVl/Ees13n+2xMBSRHkubjGhUaUeCV9svXvXuAcl1YnJERRDbWnygm+8HXJLD3slB1BBm18Qd9NRuGV8Q7e/wABdhx3sTP31fPuBnTJVLouoZd9WC34SBmiYUCMoLpnx9mA0LfDeVoIgWAiqXqPTiJkxYcJMq1PADBp8lIWjk9A9dKbqqJhKmwc+wymBQ9x/CIaG03trBUnpgTP9TpU79m/XHv3iNcKRa1uWsnBAy8XRmlLY9xheHU2cGvt9wZjOGuASX317ayBNpuYL7S+GjEJhLUuy9BlMzQlLyZnR0APP/Vjjku/8tyozQ8Y5rVZXEB0N07q3LCsPZ2qTX74Cd2e3RU4BSORDAiXmtfEXkz9fMAA7Q+VET2RLx70UDpmX9ucwQfuFWiCy09bhj4Ms3YLBwD0kM6mseRJWcVIWFJ4dwgXgRdzuxnkkTmWnY+ykwFX6DubwY8vMMgoeAyZJkjHRaSIUBjHT9+3n/JuEnCal1/D4heTJwQ7KQxlK/Jehj4otH6aYx+cpMuknRJcckn7fWsw7YSu5PdEY0h3oe90sNdVVTksa7RE9EyMgAR+8NGAEsqHm3VYN+WAJr9a4wq6qdJhMF0Yko4VoUm+250JYsRg+huzI+qQRmJOckX/NUEjo0FXoUxY=
